<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting-Started · AccelInterfaces</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">AccelInterfaces</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Julia AccelInterfaces.jl (<strong>Jai</strong>)</a></li><li><a class="tocitem" href="../api/">Jai API</a></li><li><a class="tocitem" href="../examples/">Examples</a></li><li class="is-active"><a class="tocitem" href>Getting-Started</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Preparing-a-Fortran/C/C-code-to-be-called-from-Julia"><span>Preparing a Fortran/C/C++ code to be called from Julia</span></a></li><li><a class="tocitem" href="#Annotating-Julia-main-code-with-Jai-macros"><span>Annotating Julia main code with Jai macros</span></a></li><li class="toplevel"><a class="tocitem" href="#Running-the-Julia-main-code"><span>Running the Julia main code</span></a></li><li><a class="tocitem" href="#Further-readings"><span>Further readings</span></a></li></ul></li><li><a class="tocitem" href="../jlweather/">jlweather</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting-Started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting-Started</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/grnydawn/AccelInterfaces.jl/blob/master/docs/src/man/guide.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting-Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h1><p>AccelInterfaces.jl(<strong>Jai</strong>) focuses on reusing Fortran and C/C++ codes, especially for large-scale simulation applications, within Julia. <strong>Jai</strong> does not limit its support to specific languages or programming frameworks, as long as the code can be compiled as a shared library. Currently, <strong>Jai</strong> supports the basic capabilities of Fortran, C/C++, Fortran OpenMP, Fortran OpenACC, C++ OpenMP, CUDA, as well as HIP.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p><strong>Jai</strong> can be installed using the Julia package manager. From the Julia REPL, run</p><pre><code class="nohighlight hljs">pkg&gt; add AccelInterfaces</code></pre><h2 id="Preparing-a-Fortran/C/C-code-to-be-called-from-Julia"><a class="docs-heading-anchor" href="#Preparing-a-Fortran/C/C-code-to-be-called-from-Julia">Preparing a Fortran/C/C++ code to be called from Julia</a><a id="Preparing-a-Fortran/C/C-code-to-be-called-from-Julia-1"></a><a class="docs-heading-anchor-permalink" href="#Preparing-a-Fortran/C/C-code-to-be-called-from-Julia" title="Permalink"></a></h2><p>First, we need to prepare a Fortran/C/C++(&quot;embedded&quot;) code that will be called from Julia main. The embedded code is the body part of Fortran/C/C++ function without a function signature and a functon end marker(such as &quot;end function&quot; in Fortran and &quot;}&quot;in C/C++). Jai will use the embedded code to generate a shared library after adding proper function signature based on input variables in Julia.</p><p>User can specify the function body code using Julia string that contains the code, or a Julia string that points to Jai Kernel File(.knl) in simple text format. The following Julia code calculates a vector sum, whose main algorithm is written in Fortran.</p><pre><code class="language-julia hljs"># main.jl

using AccelInterfaces

kernel_text = &quot;&quot;&quot;
[fortran]
    INTEGER i

    DO i=LBOUND(x, 1), UBOUND(x, 1)
        z(i) = x(i) + y(i)
    END DO
&quot;&quot;&quot;</code></pre><p>The &quot;kernel_text&quot; string contains a Fortran DO loop that actually calculates the vector sum. The header at the top of the string specifies that the code contains both of Fortran code.</p><h2 id="Annotating-Julia-main-code-with-Jai-macros"><a class="docs-heading-anchor" href="#Annotating-Julia-main-code-with-Jai-macros">Annotating Julia main code with Jai macros</a><a id="Annotating-Julia-main-code-with-Jai-macros-1"></a><a class="docs-heading-anchor-permalink" href="#Annotating-Julia-main-code-with-Jai-macros" title="Permalink"></a></h2><p>Once &quot;embedded&quot; code is ready as explained in previous section, we need to use Jai macros to drive the execution of the embedded code.</p><pre><code class="language-julia hljs">    # continued from previous Julia code

    const N = 10
    x = fill(1, N)
    y = fill(2, N)
    z = fill(0, N)
    answer = fill(3, N)

    @jaccel

    @jkernel kernel_text mykernel framework(fortran=&quot;gfortran -fPIC -shared&quot;)

    @jlaunch mykernel input(x, y)  output(z)

    @jdecel

    @assert z == answer</code></pre><h4 id="Creates-a-Jai-accelerator-context"><a class="docs-heading-anchor" href="#Creates-a-Jai-accelerator-context">Creates a Jai accelerator context</a><a id="Creates-a-Jai-accelerator-context-1"></a><a class="docs-heading-anchor-permalink" href="#Creates-a-Jai-accelerator-context" title="Permalink"></a></h4><p>The @jaccel directive creates a Jai accelerator context.</p><h4 id="Creates-a-Jai-kernel-context"><a class="docs-heading-anchor" href="#Creates-a-Jai-kernel-context">Creates a Jai kernel context</a><a id="Creates-a-Jai-kernel-context-1"></a><a class="docs-heading-anchor-permalink" href="#Creates-a-Jai-kernel-context" title="Permalink"></a></h4><p>The @jkernel directive creates a Jai kernel context. The user must specify the string of the kernel, as in this example. Alternatively, the user can provide Jai with a path string to a text file that contains the kernel. To identify the kernel context, we use the literal name mykernel.</p><p>The framework clause specifies the kind of acceleration, which in this example is Fortran. The user can provide Jai with the actual compiler command line to generate a shared library. The command line should include the compiler and all compiler flags, except the -o flag, which specifies the name of the output file and the path to the input source file.</p><h4 id="Launches-a-kernel"><a class="docs-heading-anchor" href="#Launches-a-kernel">Launches a kernel</a><a id="Launches-a-kernel-1"></a><a class="docs-heading-anchor-permalink" href="#Launches-a-kernel" title="Permalink"></a></h4><p>The first argument to the @jlaunch directive is the name of the kernel context used in the @jkernel directive. The user then adds the names of variables to the input and output clauses accordingly. However, it is important to note that you should only use simple variable names for inputs and outputs to/from the kernel in the @jlaunch directive. For example, you cannot write something like this:</p><pre><code class="language-julia hljs">@jlaunch mykernel input(x+1, func(y)) output(z::Vector) # Jai Syntax Error</code></pre><h4 id="Remove-a-Jai-accelerator-context"><a class="docs-heading-anchor" href="#Remove-a-Jai-accelerator-context">Remove a Jai accelerator context</a><a id="Remove-a-Jai-accelerator-context-1"></a><a class="docs-heading-anchor-permalink" href="#Remove-a-Jai-accelerator-context" title="Permalink"></a></h4><p>Lastly, &quot;@jdecel&quot; is used to declare the end of the Jai accelerator context.</p><h1 id="Running-the-Julia-main-code"><a class="docs-heading-anchor" href="#Running-the-Julia-main-code">Running the Julia main code</a><a id="Running-the-Julia-main-code-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-Julia-main-code" title="Permalink"></a></h1><p>Run the Julia main. During the first run, Jai will genrate a shared library and load the shared library and finally make a call to the function in the shared library. This process is done automatically and takes some time at the first run. Howver, once the process is finished with success, the generated shared library is cached and will be loaded immediately unless there is no change.</p><pre><code class="language-bash hljs">&gt; julia main.jl</code></pre><h2 id="Further-readings"><a class="docs-heading-anchor" href="#Further-readings">Further readings</a><a id="Further-readings-1"></a><a class="docs-heading-anchor-permalink" href="#Further-readings" title="Permalink"></a></h2><p><a href="../examples/#Examples">Examples</a> : Jai examples including using GPU</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../examples/">« Examples</a><a class="docs-footer-nextpage" href="../jlweather/">jlweather »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 24 July 2023 20:58">Monday 24 July 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
